from otter.test_files import test_case

OK_FORMAT = False

name = "question 2.3a"
points = 5

@test_case(points=1, hidden=False)
def test_tdn_type(np, FloorIsLava, make_eps_greedy_policy, tdn):
    answers = {1: [ -2.94114531,  -5.79578725,  -8.56647004, -11.25566301,
        -13.86576291, -16.39909598, -18.85792005, -21.24442652,
        -23.56074238, -25.80893201, -27.99099913, -30.10888848,
        -32.16448762, -34.15962861, -36.0960896 , -37.97559646,
        -39.7998243 , -41.57039894, -43.28889841, -44.95685431],
            10: [-14.13898624, -26.27886316, -36.70228456, -45.65193983,
        -53.33620458, -59.9339922 , -65.59891953, -70.46288356,
        -74.63913239, -78.22490197, -81.30368009, -83.94715019,
        -86.21686041, -88.16565662, -89.83891281, -91.27558753,
        -92.509131  , -93.56826394, -94.47764622, -95.25845106],
            50: [-40.10439935, -64.12517023, -78.51255523, -87.12996589,
        -92.29141577, -95.38289717, -97.23455853, -98.34362222,
        -99.00790258, -99.40577729, -99.64408674, -99.78682361,
        -99.87231672, -99.92352333, -99.95419384, -99.97256413,
        -99.98356712, -99.99015743, -99.99410473, -99.99646899]}


    env = FloorIsLava(map_name="6x6", slip_rate=0.)
    dummy_state_action_values = np.arange(36*4).reshape(36,4)
    dummy_pi = make_eps_greedy_policy(dummy_state_action_values, 0.)
    for n in [1, 10, 50]:
        dummy_state_vals = tdn(dummy_pi, env, n=n, step_size=0.01, num_episodes=20)
        np.testing.assert_allclose(np.array(answers[n]), np.array(dummy_state_vals)[:,0], atol=1e-2)

